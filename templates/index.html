<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoMind | AI Car Expert</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300E5FF'><path d='M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z'/></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'cyber': {
                            'dark': '#0f172a',
                            'darker': '#020617',
                            'cyan': '#00E5FF',
                            'green': '#10B981',
                            'purple': '#8B5CF6',
                            'text': '#F1F5F9',
                            'muted': '#94A3B8',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                        'typing': 'typing 1s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 5px #00E5FF' },
                            '50%': { boxShadow: '0 0 25px #00E5FF, 0 0 50px #00E5FF' },
                        },
                        typing: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.3' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #00E5FF; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #10B981; }
        
        /* Message content styling */
        .message-content h1, .message-content h2, .message-content h3 {
            color: #00E5FF;
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
        }
        .message-content h1 { font-size: 1.5rem; }
        .message-content h2 { font-size: 1.25rem; }
        .message-content h3 { font-size: 1.1rem; }
        .message-content p { margin: 0.5rem 0; line-height: 1.7; }
        .message-content ul, .message-content ol { 
            margin: 0.5rem 0; 
            padding-left: 1.5rem;
        }
        .message-content li { margin: 0.25rem 0; }
        .message-content li::marker { color: #00E5FF; }
        .message-content strong { color: #00E5FF; }
        .message-content code {
            background: #1e293b;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
            color: #10B981;
        }
        .message-content pre {
            background: #1e293b;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .message-content th, .message-content td {
            border: 1px solid #334155;
            padding: 0.5rem;
            text-align: left;
        }
        .message-content th {
            background: #1e293b;
            color: #00E5FF;
        }
        .message-content a {
            color: #00E5FF;
            text-decoration: underline;
        }
        
        /* Images in messages */
        .message-content img {
            max-width: 280px;
            max-height: 200px;
            border-radius: 12px;
            border: 2px solid #00E5FF;
            margin: 8px 4px;
            display: inline-block;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .message-content img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0,229,255,0.5);
        }
        
        /* Image grid for multiple images */
        .image-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }
        
        /* Video embeds */
        .message-content iframe {
            max-width: 100%;
            border-radius: 12px;
            margin: 8px 0;
        }
        
        /* Typing indicator */
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #00E5FF;
            border-radius: 50%;
            animation: typing 1s ease-in-out infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        /* Image upload preview */
        .image-preview {
            max-height: 200px;
            border-radius: 12px;
            border: 2px solid #00E5FF;
        }
        
        /* Gradient backgrounds */
        .gradient-border {
            background: linear-gradient(135deg, rgba(0,229,255,0.1), rgba(16,185,129,0.1));
            border: 1px solid rgba(0,229,255,0.3);
        }
        
        /* Hide file input */
        .file-input-hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-cyber-darker min-h-screen text-cyber-text">
    
    <div class="flex flex-col h-screen max-w-5xl mx-auto">
        
        <!-- Header -->
        <header class="p-4 border-b border-slate-700 bg-cyber-dark/90 backdrop-blur-lg sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <!-- Logo -->
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyber-cyan to-cyber-green flex items-center justify-center animate-pulse-glow">
                        <svg class="w-7 h-7 text-cyber-dark" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-cyber-cyan to-cyber-green bg-clip-text text-transparent">
                            AutoMind
                        </h1>
                        <p class="text-xs text-cyber-muted flex items-center gap-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            Powered by Gemini AI
                        </p>
                    </div>
                </div>
                
                <!-- Status Badge + New Chat Button -->
                <div class="flex items-center gap-3">
                    <div class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800 text-sm">
                        <span class="text-cyber-muted">üîç Real-time search</span>
                        <span class="text-cyber-muted">|</span>
                        <span class="text-cyber-muted">üì∏ Image analysis</span>
                    </div>
                    
                    <!-- New Chat Button -->
                    <button 
                        id="newChatBtn"
                        class="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 
                               rounded-xl transition-all duration-200 text-sm font-medium
                               border border-slate-600 hover:border-cyber-cyan"
                        title="Start a new conversation"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <span class="hidden sm:inline">New Chat</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Chat Container -->
        <main id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4">
            
            <!-- Welcome Message -->
            <div class="flex gap-3 animate-slide-up">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-cyan to-cyber-green flex-shrink-0 flex items-center justify-center">
                    <svg class="w-6 h-6 text-cyber-dark" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                    </svg>
                </div>
                <div class="flex-1 gradient-border rounded-2xl rounded-tl-none p-4">
                    <div class="message-content">
                        <p class="text-lg">Hey there, petrolhead! üöóüí®</p>
                        <p>I'm <strong>AutoMind</strong>, your AI-powered car expert! I can help you with:</p>
                        <ul class="mt-2 space-y-1">
                            <li>üîç <strong>Car specs & comparisons</strong> - with real-time web search</li>
                            <li>üì∏ <strong>Photo analysis</strong> - upload a car image and I'll identify it</li>
                            <li>üí¨ <strong>Any car questions</strong> - prices, reviews, 0-60 times, and more!</li>
                        </ul>
                        <p class="mt-3 text-cyber-muted text-sm">
                            Try: "Compare BMW M3 vs Mercedes C63 AMG" or upload a car photo!
                        </p>
                    </div>
                </div>
            </div>
            
        </main>
        
        <!-- Image Preview Area -->
        <div id="imagePreviewArea" class="hidden px-4 pb-2">
            <div class="flex items-center gap-3 p-3 bg-slate-800 rounded-xl">
                <img id="imagePreview" class="image-preview" src="" alt="Upload preview">
                <div class="flex-1">
                    <p class="text-sm text-cyber-text">Image ready for analysis</p>
                    <p class="text-xs text-cyber-muted">Add a question or just send to identify the car</p>
                </div>
                <button id="removeImageBtn" class="p-2 hover:bg-slate-700 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Input Area -->
        <footer class="p-4 border-t border-slate-700 bg-cyber-dark/90 backdrop-blur-lg">
            <form id="chatForm" class="flex gap-3 items-end">
                <!-- Image Upload Button -->
                <input type="file" id="imageInput" accept="image/*" class="file-input-hidden">
                <button 
                    type="button" 
                    id="uploadBtn"
                    class="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-all duration-200 group"
                    title="Upload car image for analysis"
                >
                    <svg class="w-6 h-6 text-cyber-muted group-hover:text-cyber-cyan transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </button>
                
                <!-- Text Input -->
                <div class="flex-1 relative">
                    <textarea 
                        id="userInput" 
                        placeholder="Ask about any car... üèéÔ∏è" 
                        rows="1"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-xl 
                               text-cyber-text placeholder-cyber-muted resize-none
                               focus:outline-none focus:border-cyber-cyan focus:ring-2 focus:ring-cyber-cyan/20 
                               transition-all duration-200"
                    ></textarea>
                </div>
                
                <!-- Send Button -->
                <button 
                    type="submit" 
                    id="sendBtn"
                    class="p-3 bg-gradient-to-r from-cyber-cyan to-cyan-600 text-cyber-dark font-semibold 
                           rounded-xl hover:from-cyber-green hover:to-emerald-600 transition-all duration-200 
                           disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                </button>
            </form>
            
            <p class="text-center text-cyber-muted text-xs mt-3">
                üöÄ Powered by Google Gemini ‚Ä¢ üîç Real-time web search ‚Ä¢ üì∏ Image analysis
            </p>
        </footer>
        
    </div>
    
    <script>
        // DOM Elements
        const chatContainer = document.getElementById('chatContainer');
        const chatForm = document.getElementById('chatForm');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const imageInput = document.getElementById('imageInput');
        const imagePreviewArea = document.getElementById('imagePreviewArea');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        
        // State
        let isLoading = false;
        let currentImage = null;
        
        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 120) + 'px';
        });
        
        // Scroll to bottom
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Create user message
        function createUserMessage(content, hasImage = false) {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex gap-3 justify-end animate-slide-up';
            
            wrapper.innerHTML = `
                <div class="max-w-[80%] bg-gradient-to-r from-cyber-cyan to-cyan-600 rounded-2xl rounded-tr-none p-4">
                    ${hasImage ? '<p class="text-cyber-dark/70 text-sm mb-2">üì∏ Image attached</p>' : ''}
                    <p class="text-cyber-dark font-medium">${escapeHtml(content)}</p>
                </div>
                <div class="w-10 h-10 rounded-xl bg-slate-700 flex-shrink-0 flex items-center justify-center">
                    <svg class="w-6 h-6 text-cyber-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
            `;
            
            return wrapper;
        }
        
        // Create AI message
        function createAIMessage(content, imageLinks = []) {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex gap-3 animate-slide-up';
            
            let linksHtml = '';
            if (imageLinks && imageLinks.length > 0) {
                linksHtml = `
                    <div class="mt-4 pt-3 border-t border-slate-600">
                        <p class="text-sm text-cyber-muted mb-2">üîó Related Links:</p>
                        <div class="flex flex-wrap gap-2">
                            ${imageLinks.map(link => `
                                <a href="${link.url}" target="_blank" 
                                   class="inline-flex items-center gap-1 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 
                                          rounded-lg text-sm text-cyber-cyan transition-colors">
                                    ${link.title}
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            wrapper.innerHTML = `
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-cyan to-cyber-green flex-shrink-0 flex items-center justify-center">
                    <svg class="w-6 h-6 text-cyber-dark" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                    </svg>
                </div>
                <div class="flex-1 gradient-border rounded-2xl rounded-tl-none p-4 max-w-[85%]">
                    <div class="message-content">${content}</div>
                    ${linksHtml}
                </div>
            `;
            
            return wrapper;
        }
        
        // Create typing indicator
        function createTypingIndicator() {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex gap-3 animate-slide-up';
            wrapper.id = 'typingIndicator';
            
            wrapper.innerHTML = `
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-cyan to-cyber-green flex-shrink-0 flex items-center justify-center animate-pulse">
                    <svg class="w-6 h-6 text-cyber-dark" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                    </svg>
                </div>
                <div class="gradient-border rounded-2xl rounded-tl-none p-4">
                    <div class="flex items-center gap-2">
                        <div class="flex gap-1">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span class="text-cyber-muted text-sm ml-2">Searching & analyzing...</span>
                    </div>
                </div>
            `;
            
            return wrapper;
        }
        
        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Handle image upload
        uploadBtn.addEventListener('click', () => {
            imageInput.click();
        });
        
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentImage = event.target.result;
                    imagePreview.src = currentImage;
                    imagePreviewArea.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });
        
        removeImageBtn.addEventListener('click', () => {
            currentImage = null;
            imageInput.value = '';
            imagePreviewArea.classList.add('hidden');
        });
        
        // Send message
        async function sendMessage(question, imageData = null) {
            const payload = { question };
            if (imageData) {
                payload.image = imageData;
            }
            
            const response = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.status === 'error') {
                throw new Error(data.response || 'Unknown error');
            }
            
            return data;
        }
        
        // Handle form submit
        async function handleSubmit(e) {
            e.preventDefault();
            
            if (isLoading) return;
            
            const question = userInput.value.trim();
            const hasImage = currentImage !== null;
            
            if (!question && !hasImage) return;
            
            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Add user message
            const displayQuestion = question || "What car is this?";
            chatContainer.appendChild(createUserMessage(displayQuestion, hasImage));
            scrollToBottom();
            
            // Hide image preview
            const imageToSend = currentImage;
            if (hasImage) {
                currentImage = null;
                imageInput.value = '';
                imagePreviewArea.classList.add('hidden');
            }
            
            // Show loading
            isLoading = true;
            sendBtn.disabled = true;
            const typingIndicator = createTypingIndicator();
            chatContainer.appendChild(typingIndicator);
            scrollToBottom();
            
            try {
                const data = await sendMessage(displayQuestion, imageToSend);
                
                // Remove typing indicator
                typingIndicator.remove();
                
                // Add AI response
                chatContainer.appendChild(createAIMessage(data.response, data.image_links));
                
            } catch (error) {
                console.error('Error:', error);
                typingIndicator.remove();
                
                chatContainer.appendChild(createAIMessage(
                    `<p class="text-red-400">üòÖ Oops! ${error.message}</p>
                     <p class="text-cyber-muted text-sm mt-2">Please try again.</p>`
                ));
            } finally {
                isLoading = false;
                sendBtn.disabled = false;
                userInput.focus();
                scrollToBottom();
            }
        }
        
        // Event listeners
        chatForm.addEventListener('submit', handleSubmit);
        
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });
        
        // New Chat button handler
        newChatBtn.addEventListener('click', async () => {
            if (isLoading) return;
            
            try {
                // Call backend to clear history
                await fetch('/clear', { method: 'POST' });
                
                // Clear the chat container
                chatContainer.innerHTML = '';
                
                // Add welcome message back
                const welcomeMsg = document.createElement('div');
                welcomeMsg.className = 'flex gap-3 animate-slide-up';
                welcomeMsg.innerHTML = `
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-cyan to-cyber-green flex-shrink-0 flex items-center justify-center">
                        <svg class="w-6 h-6 text-cyber-dark" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                        </svg>
                    </div>
                    <div class="flex-1 gradient-border rounded-2xl rounded-tl-none p-4">
                        <div class="message-content">
                            <p class="text-lg">Hey there! üöóüí® New conversation started!</p>
                            <p>I'm <strong>AutoMind</strong>, your AI car expert. How can I help you today?</p>
                            <p class="mt-3 text-cyber-muted text-sm">
                                Try: "Compare BMW M3 vs Mercedes C63 AMG" or upload a car photo!
                            </p>
                        </div>
                    </div>
                `;
                chatContainer.appendChild(welcomeMsg);
                
                // Clear any pending image
                currentImage = null;
                imageInput.value = '';
                imagePreviewArea.classList.add('hidden');
                
                userInput.focus();
            } catch (error) {
                console.error('Error clearing chat:', error);
            }
        });
        
        // Focus on load
        window.addEventListener('load', () => {
            userInput.focus();
        });
        
        // Drag and drop for images
        document.body.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
        
        document.body.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentImage = event.target.result;
                    imagePreview.src = currentImage;
                    imagePreviewArea.classList.remove('hidden');
                };
                reader.readAsDataURL(files[0]);
            }
        });
    </script>
</body>
</html>
